<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Danh sách phim</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
  .movie { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; }
  iframe { width: 300px; height: 170px; }
  input { margin-bottom: 20px; padding: 5px; width: 300px; }
</style>
</head>
<body>

<h1>Danh sách phim</h1>
<input type="text" id="search" placeholder="Tìm phim hoặc diễn viên...">
<div id="movies"></div>

<script>
const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEk-aqaR88i7iLGsHE0keLBBqvpCPnh-6fB8Kd8rQL658q4P_u-5LDByzazI7KS8PtGMl7neIm95Hn/pub?output=csv';
let allMovies = [];

// Chuyển CSV sang JSON
async function fetchMovies() {
  const res = await fetch(sheetUrl);
  const text = await res.text();
  const rows = text.trim().split('\n').map(r => r.split(','));
  const header = rows.shift();
  const movies = rows.map(r => {
    let obj = {};
    header.forEach((h,i) => obj[h.trim()] = r[i]?.trim());
    return obj;
  });
  return movies;
}

// Hiển thị danh sách phim
function displayMovies(list) {
  const container = document.getElementById('movies');
  container.innerHTML = '';
  list.forEach(m => {
    const div = document.createElement('div');
    div.className = 'movie';
    div.innerHTML = `
      <h3>${m['TenPhim']}</h3>
      <p>Diễn viên: ${m['DienVien']}</p>
      <p>Thể loại: ${m['TheLoai']}</p>
      <p>${m['MoTa']}</p>
      <a href="${m['Slug']}.html" target="_blank">Xem phim →</a>
    `;
    container.appendChild(div);
  });
}

// Tìm kiếm phim / diễn viên
document.getElementById('search').addEventListener('input', () => {
  const term = document.getElementById('search').value.toLowerCase();
  const filtered = allMovies.filter(m => 
    m['TenPhim'].toLowerCase().includes(term) || 
    m['DienVien'].toLowerCase().includes(term)
  );
  displayMovies(filtered);
});

// Load dữ liệu
fetchMovies().then(list => {
  allMovies = list;
  displayMovies(list);
});
</script>

</body>
</html>
