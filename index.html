<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Danh sach phim</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
  .movie { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; }
  iframe { width: 300px; height: 170px; }
</style>
</head>
<body>

<h1>Danh sach phim</h1>
<div id="movies"></div>

<script>
const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-EXAMPLE/pub?output=csv';

// Chuyen CSV sang JSON
async function fetchMovies() {
  const res = await fetch(sheetUrl);
  const text = await res.text();
  const rows = text.split('\n').map(r => r.split(','));
  const header = rows.shift();
  const movies = rows.map(r => {
    let obj = {};
    header.forEach((h,i) => obj[h.trim()] = r[i]?.trim());
    return obj;
  });
  return movies;
}

// Tao trang phim rieng
function createMoviePage(movie) {
  const html = `
  <!DOCTYPE html>
  <html lang="vi">
  <head>
    <meta charset="UTF-8">
    <title>${movie['TenPhim']}</title>
    <meta name="description" content="${movie['Description'] || ''}">
    <meta name="keywords" content="${movie['Keywords'] || ''}">
    <meta property="og:image" content="${movie['Thumbnail'] || ''}">
    <style>
      body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
      iframe { width: 80%; height: 400px; }
    </style>
  </head>
  <body>
    <h1>${movie['TenPhim']}</h1>
    <p><strong>The loai:</strong> ${movie['TheLoai']}</p>
    <p>${movie['MoTa']}</p>
    <iframe src="${movie['LinkIframe']}" frameborder="0" allowfullscreen></iframe>
    <p><strong>Nam:</strong> ${movie['Nam']}</p>
    <a href="index.html">← Ve trang danh sach</a>
  </body>
  </html>
  `;
  return html;
}

// Hien thi danh sach va tao link
fetchMovies().then(list => {
  const container = document.getElementById('movies');
  list.forEach(m => {
    const div = document.createElement('div');
    div.className = 'movie';
    div.innerHTML = `
      <h3>${m['TenPhim']}</h3>
      <p>${m['MoTa']}</p>
      <a href="${m['Slug']}.html">Xem phim →</a>
    `;
    container.appendChild(div);

    // Tao file HTML rieng (chi demo, tren GitHub Pages can pre-generate)
    console.log(`Trang ${m['Slug']}.html:\n`, createMoviePage(m));
  });
});
</script>

</body>
</html>
